<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ordjagt ‚Äì Morfemer</title>
  <style>
    :root{--ink:#111827;--muted:#6b7280;--card:#fff;--bg:#f7f7fb;--ok:#10b981;--bad:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--ink)}
    .wrap{max-width:980px;margin:22px auto;padding:0 16px}
    .card{background:var(--card);border-radius:14px;box-shadow:0 10px 24px rgba(0,0,0,.08);padding:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .pill{background:#eef2ff;color:#1e40af;border-radius:999px;padding:6px 10px;font-weight:700}
    .muted{color:var(--muted)}
    h1{margin:.2rem 0 .5rem}
    .section{margin-top:10px}
    .label{font-weight:800;margin:6px 0}
    .bank{display:flex;flex-wrap:wrap;gap:8px}
    .chip{padding:8px 12px;border:1px solid #e5e7eb;border-radius:999px;background:#fff;cursor:pointer}
    .chip.active{outline:2px solid #2563eb}
    .good{color:var(--ok)} .bad{color:var(--bad)}
    button{border:0;background:#111827;color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600}
    button.ghost{background:#eef2ff;color:#1e40af}
    textarea,input{width:100%;padding:10px;border-radius:10px;border:1px solid #e5e7eb}
    .hidden{display:none}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px}
    .found-item{background:#f1f5f9;border:1px solid #e2e8f0;border-radius:10px;padding:8px;text-align:center;font-weight:700}
    .kbd{font-family:ui-monospace,Menlo,monospace;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:6px;padding:2px 6px}
    .hint{font-size:.9rem;color:var(--muted)}
  </style>
</head>
<body>
<div class="wrap">
  <h1>üß© Ordjagt ‚Äì Morfemer</h1>
  <p class="muted">Byg ord med morfemer: <b>forstavelse</b> (valgfri) + <b>rod</b> (obligatorisk) + <b>binde</b> (valgfri) + <b>afledning</b> (valgfri).  
  Samme ord t√¶ller kun √©n gang. Ordlisten (hvis brugt) er skjult for elever.</p>

  <!-- HUD -->
  <div class="card">
    <div class="row">
      <span class="pill">‚è±Ô∏è Tid: <b id="timeLeft">60</b>s</span>
      <span class="pill">üéØ Point: <b id="points">0</b></span>
      <span class="pill">üìö Ord: <b id="wordsCount">0</b></span>
      <span class="pill">üîí L√¶rerpanel: tryk <span class="kbd">L</span></span>
    </div>
    <div class="row" style="margin-top:10px">
      <label style="flex:1;min-width:160px">Varighed (sek.)
        <input id="duration" type="number" min="15" max="600" value="60">
      </label>
      <label style="flex:2;min-width:260px">Beskrivelse (navn/klasse)
        <input id="playerName" placeholder="fx 4B ‚Äì Sofie">
      </label>
    </div>
  </div>

  <!-- Morfem-banker -->
  <div class="card section">
    <div class="label">Forstavelser (pr√¶fikser)</div>
    <div id="bank-prefix" class="bank"></div>

    <div class="label">Rod</div>
    <div id="bank-root" class="bank"></div>

    <div class="label">Binde</div>
    <div id="bank-link" class="bank"></div>

    <div class="label">Afledningsmorfemer (suffikser)</div>
    <div id="bank-suf" class="bank"></div>

    <div class="section">
      <div>Dit ord: <b id="currentWord">‚Äî</b> <span id="structureMsg" class="hint"></span></div>
      <div class="row" style="margin-top:8px">
        <button id="submit">Tjek ord ‚úÖ</button>
        <button id="undo" class="ghost">Fortryd ‚ü≤</button>
        <button id="clear" class="ghost">Nulstil ‚úñ</button>
        <button id="shuffle" class="ghost">Bland morfemer üîÄ</button>
        <button id="start" class="ghost">Start/Genstart ‚ñ∂</button>
      </div>
      <div id="message" class="muted" style="margin-top:6px"></div>
    </div>
  </div>

  <!-- Fundne ord -->
  <div class="card section">
    <h3>Fundne ord</h3>
    <div id="foundWrap"><div id="found" class="grid"></div></div>
  </div>

  <!-- L√¶rerpanel (skjult) -->
  <div id="teacher" class="card section hidden">
    <h3>üîê L√¶rerpanel</h3>
    <p class="hint">Panelet er skjult for elever. √Öbn med PIN. (Skift PIN i koden ‚Äì se kommentar ‚ÄúL√ÜRERPIN‚Äù.)</p>
    <div class="row">
      <label style="flex:1;min-width:260px">Forstavelser (komma)
        <textarea id="ta-prefix"></textarea>
      </label>
      <label style="flex:1;min-width:260px">Rod (komma)
        <textarea id="ta-root"></textarea>
      </label>
      <label style="flex:1;min-width:260px">Binde (komma)
        <textarea id="ta-link"></textarea>
      </label>
      <label style="flex:1;min-width:260px">Afledninger (komma)
        <textarea id="ta-suf"></textarea>
      </label>
    </div>
    <div class="row">
      <label style="flex:1;min-width:260px">Hemmelig ordliste (√©t ord pr. linje ‚Äì valgfri)
        <textarea id="ta-wordlist" placeholder="Lad st√• tom for ren struktur-check."></textarea>
      </label>
      <div style="flex:1;min-width:240px">
        <label><input type="checkbox" id="ck-hide-found"> Skjul ‚ÄúFundne ord‚Äù for elever (vis kun ved tidsudl√∏b)</label><br>
        <label><input type="checkbox" id="ck-use-wordlist" checked> Brug ordliste til validering (ud over struktur)</label><br>
        <label><input type="checkbox" id="ck-allow-nolink" checked> Tillad ord uden bindemorfem</label><br>
        <label><input type="checkbox" id="ck-allow-nosuf" checked> Tillad ord uden afledning</label><br>
        <button id="apply">Opdater s√¶t ‚ñ∂</button>
      </div>
    </div>
  </div>

  <p class="hint">Genveje: Enter = tjek ¬∑ Backspace = fortryd ¬∑ Esc = nulstil ord ¬∑ <b>L</b> = l√¶rerpanel</p>
</div>

<script>
/*** L√ÜRERPIN ‚Äì skift her hvis du vil ***/
const TEACHER_PIN = "1234";
/*****************************************/

let prefix=[], roots=[], links=[], sufs=[];
let useWordlist=true, allowNoLink=true, allowNoSuf=true, hideFound=false;
let wordlistSet = new Set();

let selected = { prefix:null, root:null, link:null, suf:null };
let foundSet = new Set();
let points = 0, tLeft = 60, timer = null;

const els = {
  timeLeft: document.getElementById('timeLeft'),
  points: document.getElementById('points'),
  wordsCount: document.getElementById('wordsCount'),
  message: document.getElementById('message'),
  struct: document.getElementById('structureMsg'),
  current: document.getElementById('currentWord'),
  found: document.getElementById('found'),
  foundWrap: document.getElementById('foundWrap'),
  duration: document.getElementById('duration'),
  name: document.getElementById('playerName'),
  teacher: document.getElementById('teacher'),

  bPrefix: document.getElementById('bank-prefix'),
  bRoot: document.getElementById('bank-root'),
  bLink: document.getElementById('bank-link'),
  bSuf: document.getElementById('bank-suf'),

  taPrefix: document.getElementById('ta-prefix'),
  taRoot: document.getElementById('ta-root'),
  taLink: document.getElementById('ta-link'),
  taSuf: document.getElementById('ta-suf'),
  taWordlist: document.getElementById('ta-wordlist'),

  ckHideFound: document.getElementById('ck-hide-found'),
  ckUseWordlist: document.getElementById('ck-use-wordlist'),
  ckAllowNoLink: document.getElementById('ck-allow-nolink'),
  ckAllowNoSuf: document.getElementById('ck-allow-nosuf'),
};

function chips(target, arr, type){
  target.innerHTML='';
  arr.forEach((m)=>{
    const b = document.createElement('button');
    b.className = 'chip';
    b.textContent = m;
    b.addEventListener('click', ()=>{
      // toggle select (kun √©n pr. kategori)
      if (selected[type] === m){ selected[type] = null; b.classList.remove('active'); }
      else { selected[type] = m; [...target.children].forEach(c=>c.classList.remove('active')); b.classList.add('active'); }
      updateCurrent();
    });
    target.appendChild(b);
  });
}

function renderBanks(){
  chips(els.bPrefix, prefix, 'prefix');
  chips(els.bRoot, roots, 'root');
  chips(els.bLink, links, 'link');
  chips(els.bSuf, sufs, 'suf');
}

function updateCurrent(){
  const w = (selected.prefix||'') + (selected.root||'') + (selected.link||'') + (selected.suf||'');
  els.current.textContent = w || '‚Äî';
  const parts = [
    selected.prefix ? 'forst.' : '‚Äî',
    selected.root ? 'rod' : '‚Äî',
    selected.link ? 'binde' : '‚Äî',
    selected.suf ? 'afl.' : '‚Äî'
  ].join(' ¬∑ ');
  els.struct.textContent = 'Struktur: ' + parts;
}

function renderFound(){
  els.found.innerHTML = '';
  Array.from(foundSet).sort((a,b)=>a.localeCompare(b)).forEach(w=>{
    const d = document.createElement('div');
    d.className = 'found-item';
    d.textContent = w;
    els.found.appendChild(d);
  });
  els.wordsCount.textContent = foundSet.size;
}

function setMsg(txt, ok){ els.message.textContent = txt || ''; els.message.className = ok ? 'good' : 'muted'; }

function start(){
  tLeft = Math.max(15, Math.min(600, +els.duration.value || 60));
  els.timeLeft.textContent = tLeft;
  points = 0; els.points.textContent = '0';
  foundSet = new Set(); renderFound();
  selected = { prefix:null, root:null, link:null, suf:null };
  updateCurrent(); setMsg('Klar!');
  tick();
}
function tick(){
  clearTimeout(timer);
  els.timeLeft.textContent = tLeft;
  if (tLeft <= 0){ setMsg('‚èπ Tid slut!'); return; }
  timer = setTimeout(()=>{ tLeft--; tick(); }, 1000);
}

function validateStructure(){
  // Krav: rod skal v√¶re valgt. Forstavelse/binde/afledning er valgfrie afh√¶ngig af indstillinger
  if (!selected.root) return { ok:false, reason:'Manglende rod' };
  if (!allowNoLink && !selected.link) return { ok:false, reason:'Kr√¶ver bindemorfem' };
  if (!allowNoSuf && !selected.suf) return { ok:false, reason:'Kr√¶ver afledning' };
  // Simple r√¶kkef√∏lge: prefix -> root -> link -> suf (vi bygger allerede i den r√¶kkef√∏lge)
  return { ok:true };
}

function submit(){
  const word = (selected.prefix||'') + (selected.root||'') + (selected.link||'') + (selected.suf||'');
  if (!word || word.length < 3){ setMsg('For kort.'); return; }
  if (foundSet.has(word)){ setMsg('Allerede fundet.'); return; }

  // 1) Struktur
  const s = validateStructure();
  if (!s.ok){ setMsg('‚ùå '+s.reason); return; }

  // 2) Ordlistetjek (valgfri)
  let valid = true;
  if (useWordlist && wordlistSet.size){ valid = wordlistSet.has(word.toLowerCase()); }

  if (valid){
    foundSet.add(word);
    points++; els.points.textContent = String(points);
    if (!hideFound) renderFound();
    setMsg('‚úî Godkendt!', true);
    // nulstil valg, men lad chips forblive synlige
    selected = { prefix:null, root:null, link:null, suf:null };
    [...els.bPrefix.children, ...els.bRoot.children, ...els.bLink.children, ...els.bSuf.children].forEach(c=>c.classList.remove('active'));
    updateCurrent();
  } else {
    setMsg('‚ùå Ikke i ordlisten.');
  }
}

/*** L√¶rerpanel, data & toggles ***/
function applyFromTeacher(){
  prefix = els.taPrefix.value.split(',').map(s=>s.trim()).filter(Boolean);
  roots  = els.taRoot.value.split(',').map(s=>s.trim()).filter(Boolean);
  links  = els.taLink.value.split(',').map(s=>s.trim()).filter(Boolean);
  sufs   = els.taSuf.value.split(',').map(s=>s.trim()).filter(Boolean);
  wordlistSet = new Set(els.taWordlist.value.split(/\r?\n/).map(s=>s.trim().toLowerCase()).filter(Boolean));
  useWordlist = els.ckUseWordlist.checked;
  allowNoLink = els.ckAllowNoLink.checked;
  allowNoSuf  = els.ckAllowNoSuf.checked;
  hideFound   = els.ckHideFound.checked;
  els.foundWrap.style.display = hideFound ? 'none' : 'block';
  renderBanks(); updateCurrent(); setMsg('S√¶t opdateret!', true);
}

function initDefaults(){
  // Standard-s√¶t (skoletema)
  prefix = ['u-','for-','mis-','gen-','be-'];        // forstavelser
  roots  = ['l√¶s','skriv','bog','stav','l√¶r','skole']; // r√∏dder
  links  = ['e','s'];                                 // bindemorfemer
  sufs   = ['-er','-ning','-lig','-hed','-skab'];     // afledninger

  // Hemmelig ordliste ‚Äì kan st√• tom
  const hiddenWords = [
    'bogstav','l√¶sebog','skrivebog','skolestart','l√¶rer-hed' // eksempel (v√¶r fri til at skifte)
  ];

  els.taPrefix.value = prefix.join(', ');
  els.taRoot.value   = roots.join(', ');
  els.taLink.value   = links.join(', ');
  els.taSuf.value    = sufs.join(', ');
  els.taWordlist.value = hiddenWords.join('\n');

  els.ckUseWordlist.checked = true;
  els.ckAllowNoLink.checked = true;
  els.ckAllowNoSuf.checked  = true;
  els.ckHideFound.checked   = false;

  applyFromTeacher();
}

function shuffleBanks(){
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
  shuffle(prefix); shuffle(roots); shuffle(links); shuffle(sufs);
  renderBanks();
}

/*** Events ***/
document.getElementById('submit').addEventListener('click', submit);
document.getElementById('undo').addEventListener('click', ()=>{ // fortryd: ryd sidste valgte i r√¶kkef√∏lge suf->link->root->prefix
  if (selected.suf) selected.suf = null;
  else if (selected.link) selected.link = null;
  else if (selected.root) selected.root = null;
  else if (selected.prefix) selected.prefix = null;
  [...els.bPrefix.children, ...els.bRoot.children, ...els.bLink.children, ...els.bSuf.children].forEach(c=>c.classList.remove('active'));
  updateCurrent();
});
document.getElementById('clear').addEventListener('click', ()=>{ selected={prefix:null,root:null,link:null,suf:null}; [...els.bPrefix.children, ...els.bRoot.children, ...els.bLink.children, ...els.bSuf.children].forEach(c=>c.classList.remove('active')); updateCurrent(); setMsg(''); });
document.getElementById('shuffle').addEventListener('click', shuffleBanks);
document.getElementById('start').addEventListener('click', start);
document.getElementById('apply').addEventListener('click', applyFromTeacher);

// Keyboard: Enter/Backspace/Escape + L (l√¶rer)
window.addEventListener('keydown', (e)=>{
  const gameActive = true; // altid aktiv i denne udgave
  if (e.key === 'Enter'){ submit(); }
  else if (e.key === 'Backspace'){ e.preventDefault(); const order=['suf','link','root','prefix']; for(const k of order){ if (selected[k]){ selected[k]=null; break; } } updateCurrent(); }
  else if (e.key === 'Escape'){ selected={prefix:null,root:null,link:null,suf:null}; [...els.bPrefix.children, ...els.bRoot.children, ...els.bLink.children, ...els.bSuf.children].forEach(c=>c.classList.remove('active')); updateCurrent(); }
  else if (e.key.toLowerCase() === 'l'){ // l√¶rerpanel
    const pin = prompt('Indtast PIN for l√¶rerpanel:');
    if (pin === TEACHER_PIN){ els.teacher.classList.toggle('hidden'); }
    else if (pin) { alert('Forkert PIN'); }
  }
});

// Init
initDefaults();
start();
renderFound();
</script>
</body>
</html>

